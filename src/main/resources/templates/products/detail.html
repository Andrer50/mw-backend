<!DOCTYPE html>
<html
	lang="es"
	xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0" />
		<title th:text="${product.name} + ' - ElectroStore'">Producto - ElectroStore</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
			rel="stylesheet" />
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
			rel="stylesheet" />
	</head>
	<body>
		<!-- Navbar (reutilizable) -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
			<div class="container">
				<a
					class="navbar-brand"
					href="/">
					<i class="bi bi-lightning-charge"></i> ElectroStore
				</a>
				<ul class="navbar-nav ms-auto">
					<li class="nav-item">
						<a
							class="nav-link"
							href="/web/cart">
							<i class="bi bi-cart"></i> Carrito
						</a>
					</li>
				</ul>
			</div>
		</nav>

		<div class="container py-5">
			<div class="row">
				<!-- Imagen del producto -->
				<div class="col-lg-6">
					<img
						th:src="${product.detailProduct.imageUrl != null ? product.detailProduct.imageUrl : 'https://via.placeholder.com/500x400'}"
						class="img-fluid rounded shadow"
						th:alt="${product.name}" />
				</div>

				<!-- Información del producto -->
				<div class="col-lg-6">
					<h1 th:text="${product.name}"></h1>
					<h5
						class="text-muted mb-3"
						th:text="${product.detailProduct.commercialName}"></h5>

					<!-- Rating -->
					<div
						class="mb-3"
						th:if="${reviewCount > 0}">
						<div class="d-flex align-items-center">
							<div class="text-warning me-2">
								<span th:each="star : ${#numbers.sequence(1, 5)}">
									<i th:class="${star <= averageRating} ? 'bi bi-star-fill' : 'bi bi-star'"></i>
								</span>
							</div>
							<span th:text="${#numbers.formatDecimal(averageRating, 1, 1)}"></span>
							<span
								class="text-muted ms-2"
								th:text="'(' + ${reviewCount} + ' reseñas)'"></span>
						</div>
					</div>

					<!-- Precio -->
					<div class="mb-4">
						<h2
							class="text-primary fw-bold"
							th:text="'$' + ${product.detailProduct.price}"></h2>
						<div
							th:if="${product.detailProduct.discount > 0}"
							class="text-success">
							<small th:text="'Descuento: ' + ${product.detailProduct.discount} + '%'"></small>
						</div>
					</div>

					<!-- Stock -->
					<div class="mb-3">
						<span
							th:if="${product.stock > 0}"
							class="badge bg-success fs-6">
							<i class="bi bi-check-circle"></i> En Stock (th:text="${product.stock}")
						</span>
						<span
							th:if="${product.stock == 0}"
							class="badge bg-danger fs-6">
							<i class="bi bi-x-circle"></i> Sin Stock
						</span>
					</div>

					<!-- Descripción -->
					<div class="mb-4">
						<h5>Descripción</h5>
						<p th:text="${product.detailProduct.description}"></p>
					</div>

					<!-- Especificaciones -->
					<div class="mb-4">
						<h5>Especificaciones</h5>
						<ul class="list-unstyled">
							<li><strong>Marca:</strong> <span th:text="${product.detailProduct.brand}"></span></li>
							<li><strong>Modelo:</strong> <span th:text="${product.detailProduct.model}"></span></li>
							<li><strong>Condición:</strong> <span th:text="${product.productCondition}"></span></li>
							<li><strong>Especificaciones:</strong> <span th:text="${product.detailProduct.specifications}"></span></li>
						</ul>
					</div>

					<!-- Formulario para agregar al carrito -->
					<form
						th:action="@{/web/cart/add}"
						method="post"
						th:if="${product.stock > 0}">
						<input
							type="hidden"
							name="productId"
							th:value="${product.id}" />
						<div class="row mb-3">
							<div class="col-4">
								<label
									for="quantity"
									class="form-label"
									>Cantidad:</label
								>
								<input
									type="number"
									class="form-control"
									id="quantity"
									name="quantity"
									value="1"
									min="1"
									th:max="${product.stock}" />
							</div>
						</div>
						<button
							type="submit"
							class="btn btn-primary btn-lg me-2">
							<i class="bi bi-cart-plus"></i> Agregar al Carrito
						</button>
					</form>

					<div th:if="${product.stock == 0}">
						<button
							class="btn btn-secondary btn-lg"
							disabled>
							<i class="bi bi-x-circle"></i> Sin Stock
						</button>
					</div>
				</div>
			</div>

			<!-- Reseñas -->
			<div
				class="row mt-5"
				th:if="${not #lists.isEmpty(reviews)}">
				<div class="col-12">
					<h3>Reseñas de Clientes</h3>
					<div class="row">
						<div class="col-lg-8">
							<div
								th:each="review : ${reviews}"
								class="card mb-3">
								<div class="card-body">
									<div class="d-flex justify-content-between align-items-start">
										<div>
											<h6 th:text="${review.user.name + ' ' + review.user.lastName}"></h6>
											<div class="text-warning mb-2">
												<span th:each="star : ${#numbers.sequence(1, 5)}">
													<i th:class="${star <= review.rating} ? 'bi bi-star-fill' : 'bi bi-star'"></i>
												</span>
											</div>
											<p th:text="${review.comment}"></p>
										</div>
										<small
											class="text-muted"
											th:text="${#temporals.format(review.reviewDate, 'dd/MM/yyyy')}"></small>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>

			<!-- Productos relacionados -->
			<div
				class="row mt-5"
				th:if="${not #lists.isEmpty(relatedProducts)}">
				<div class="col-12">
					<h3>Productos Relacionados</h3>
					<div class="row">
						<div
							class="col-lg-3 col-md-6 mb-4"
							th:each="related : ${relatedProducts}">
							<div class="card h-100">
								<img
									th:src="${related.detailProduct.imageUrl != null ? related.detailProduct.imageUrl : 'https://via.placeholder.com/300x200'}"
									class="card-img-top"
									style="height: 200px; object-fit: cover"
									th:alt="${related.name}" />
								<div class="card-body">
									<h6
										class="card-title"
										th:text="${related.name}"></h6>
									<p
										class="text-primary fw-bold"
										th:text="'$' + ${related.detailProduct.price}"></p>
									<a
										th:href="@{/web/products/{id}(id=${related.id})}"
										class="btn btn-outline-primary btn-sm"
										>Ver Detalles</a
									>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>
