<!DOCTYPE html>
<html
	lang="es"
	xmlns:th="http://www.thymeleaf.org">
	<head>
		<meta charset="UTF-8" />
		<meta
			name="viewport"
			content="width=device-width, initial-scale=1.0" />
		<title>Mi Carrito - ElectroStore</title>
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css"
			rel="stylesheet" />
		<link
			href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.7.2/font/bootstrap-icons.css"
			rel="stylesheet" />
	</head>
	<body>
		<!-- Navbar -->
		<nav class="navbar navbar-expand-lg navbar-dark bg-primary">
			<div class="container">
				<a
					class="navbar-brand"
					href="/">
					<i class="bi bi-lightning-charge"></i> ElectroStore
				</a>
				<ul class="navbar-nav ms-auto">
					<li class="nav-item">
						<a
							class="nav-link"
							href="/products"
							>Seguir Comprando</a
						>
					</li>
				</ul>
			</div>
		</nav>

		<div class="container py-5">
			<!-- Mensajes de éxito/error -->
			<div
				th:if="${success}"
				class="alert alert-success alert-dismissible fade show"
				role="alert">
				<i class="bi bi-check-circle"></i> <span th:text="${success}"></span>
				<button
					type="button"
					class="btn-close"
					data-bs-dismiss="alert"></button>
			</div>

			<div
				th:if="${error}"
				class="alert alert-danger alert-dismissible fade show"
				role="alert">
				<i class="bi bi-exclamation-triangle"></i> <span th:text="${error}"></span>
				<button
					type="button"
					class="btn-close"
					data-bs-dismiss="alert"></button>
			</div>

			<h1 class="mb-4"><i class="bi bi-cart"></i> Mi Carrito de Compras</h1>

			<!-- Carrito vacío -->
			<div
				th:if="${#lists.isEmpty(cart.purchaseCartItems)}"
				class="text-center py-5">
				<i class="bi bi-cart-x display-1 text-muted"></i>
				<h3 class="mt-3">Tu carrito está vacío</h3>
				<p class="text-muted">Agrega algunos productos increíbles a tu carrito</p>
				<a
					href="/products"
					class="btn btn-primary"
					>Explorar Productos</a
				>
			</div>

			<!-- Items del carrito -->
			<div th:if="${not #lists.isEmpty(cart.purchaseCartItems)}">
				<div class="row">
					<div class="col-lg-8">
						<!-- Lista de productos -->
						<div
							class="card mb-4"
							th:each="item : ${cart.purchaseCartItems}">
							<div class="card-body">
								<div class="row align-items-center">
									<!-- Imagen del producto -->
									<div class="col-md-2">
										<img
											th:src="${item.product.detailProduct.imageUrl != null ? item.product.detailProduct.imageUrl : 'https://via.placeholder.com/100x80'}"
											class="img-fluid rounded"
											th:alt="${item.product.name}"
											style="max-height: 80px" />
									</div>

									<!-- Información del producto -->
									<div class="col-md-4">
										<h6 th:text="${item.product.name}"></h6>
										<small
											class="text-muted"
											th:text="${item.product.detailProduct.brand + ' - ' + item.product.detailProduct.model}"></small>
										<br />
										<span
											class="text-primary fw-bold"
											th:text="'$' + ${item.product.detailProduct.price}"></span>
									</div>

									<!-- Cantidad -->
									<div class="col-md-3">
										<form
											th:action="@{/web/cart/update/{id}(id=${item.id})}"
											method="post"
											class="d-flex align-items-center">
											<label class="me-2">Cantidad</label>
											<input
												type="number"
												class="form-control form-control-sm me-2"
												name="quantity"
												th:value="${item.quantity}"
												min="1"
												th:max="${item.product.stock}"
												style="width: 80px" />
											<button
												type="submit"
												class="btn btn-outline-primary btn-sm">
												<i class="bi bi-arrow-clockwise"></i>
											</button>
										</form>
									</div>

									<!-- Subtotal y acciones -->
									<div class="col-md-3 text-end">
										<div
											class="fw-bold text-primary mb-2"
											th:text="'$' + ${item.subtotal}"></div>
										<form
											th:action="@{/web/cart/remove/{id}(id=${item.id})}"
											method="post"
											style="display: inline">
											<button
												type="submit"
												class="btn btn-outline-danger btn-sm"
												onclick="return confirm('¿Estás seguro de eliminar este producto?')">
												<i class="bi bi-trash"></i> Eliminar
											</button>
										</form>
									</div>
								</div>
							</div>
						</div>
					</div>

					<!-- Resumen del pedido -->
					<div class="col-lg-4">
						<div class="card">
							<div class="card-header">
								<h5 class="mb-0">Resumen del Pedido</h5>
							</div>
							<div class="card-body">
								<div class="d-flex justify-content-between mb-2">
									<span>Items:</span>
									<span th:text="${totalItems}"></span>
								</div>
								<div class="d-flex justify-content-between mb-2">
									<span>Subtotal:</span>
									<span th:text="'$' + ${cartTotal}"></span>
								</div>
								<div class="d-flex justify-content-between mb-2">
									<span>IGV (18%):</span>
									<span th:text="'$' + ${#numbers.formatDecimal(cartTotal * 0.18, 1, 2)}"></span>
								</div>
								<hr />
								<div class="d-flex justify-content-between fs-5 fw-bold">
									<span>Total:</span>
									<span
										class="text-primary"
										th:text="'$' + ${#numbers.formatDecimal(cartTotal * 1.18, 1, 2)}"></span>
								</div>
							</div>
							<div class="card-footer">
								<a
									href="/orders/checkout"
									class="btn btn-success w-100 mb-2">
									<i class="bi bi-credit-card"></i> Proceder al Checkout
								</a>
								<form
									action="/web/cart/clear"
									method="post">
									<button
										type="submit"
										class="btn btn-outline-secondary w-100"
										onclick="return confirm('¿Estás seguro de limpiar todo el carrito?')">
										<i class="bi bi-trash"></i> Limpiar Carrito
									</button>
								</form>
							</div>
						</div>
					</div>
				</div>
			</div>
		</div>

		<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
	</body>
</html>
